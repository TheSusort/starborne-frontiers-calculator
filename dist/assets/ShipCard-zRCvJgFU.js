import{u as B,e as H,F as z,R as K,j as a,I as S,B as b,m as $,k as W,C as U,l as Y,G as J,M as Q,i as V}from"./ui-D2YqbPcu.js";import{a as c}from"./vendor-BhvhDhpY.js";import{S as X}from"./ships-data-B9_KdinZ.js";import{S as _}from"./StatModifierInput-CjKO7zbw.js";import{a as Z}from"./ShipDisplay-ApR9I5gC.js";import{G as g}from"./GearSlot-BtS1uLEJ.js";import{G as ee}from"./GearInventory-YrEp50QN.js";import{u as ae,a as te}from"./useGear-BHcAIW33.js";async function se(s){const e=X[s.toUpperCase().replace(" ","_")];return e?{baseStats:{hp:e.hp,attack:e.attack,defence:e.defense,hacking:e.hacking,security:e.security,crit:e.critRate,critDamage:e.critDamage,speed:e.speed,healModifier:0},faction:e.faction.toUpperCase().replace(" ","_"),type:e.role.toUpperCase(),rarity:e.rarity.toLowerCase(),affinity:e.affinity.toUpperCase()}:null}const G={hp:0,attack:0,defence:0,hacking:0,security:0,crit:0,critDamage:0,speed:0,healModifier:0},le=[{value:"chemical",label:"Chemical"},{value:"electric",label:"Electric"},{value:"thermal",label:"Thermal"},{value:"antimatter",label:"Antimatter"}],de=({onSubmit:s,editingShip:e})=>{const[d,k]=c.useState((e==null?void 0:e.name)||""),[F,h]=c.useState((e==null?void 0:e.baseStats)||G),[O,C]=c.useState((e==null?void 0:e.faction)||""),[D,N]=c.useState((e==null?void 0:e.type)||""),[R,I]=c.useState((e==null?void 0:e.rarity)||""),[m,n]=c.useState((e==null?void 0:e.refits)||[]),[o,p]=c.useState((e==null?void 0:e.implants)||[]),[q,u]=c.useState(!1),[x,f]=c.useState(null),{addNotification:w}=B(),[E,A]=c.useState(e==null?void 0:e.affinity);c.useEffect(()=>{e&&(k(e.name),h(e.baseStats),C(e.faction),N(e.type),I(e.rarity),n(e.refits),p(e.implants),A(e.affinity))},[e]);const L=async t=>{t.preventDefault();const r={id:(e==null?void 0:e.id)||Date.now().toString(),name:d,faction:O,type:D,rarity:R,affinity:E,baseStats:F,equipment:(e==null?void 0:e.equipment)||{},equipmentLocked:(e==null?void 0:e.equipmentLocked)||!1,refits:m,implants:o};try{await s(r),k(""),h(G),C(""),N(""),I(""),n([]),p([])}catch(i){w("error","Failed to save ship data"),console.error("Error saving ship:",i)}},M=async()=>{if(d){u(!0),f(null);try{const t=await se(d);if(!t){f("Could not find ship data. If it's a newer ship, I may not have it in the database yet.");return}h(t.baseStats),C(t.faction),N(t.type),I(t.rarity),A(t.affinity),w("success","Ship data fetched successfully")}catch(t){f("Failed to fetch ship data. If it's a newer ship, I may not have it in the database yet."),console.error("Error fetching ship data:",t),w("error","Failed to fetch ship data. If it's a newer ship, I may not have it in the database yet.")}finally{u(!1)}}},T=Object.entries(H).map(([t,r])=>({value:t,label:r.name})),l=Object.entries(z).map(([t,r])=>({value:t,label:r.name})),y=Object.entries(K).map(([t,r])=>({value:r.value,label:r.label})),v=t=>{window.confirm("Are you sure you want to remove this implant?")&&p(o.filter((r,i)=>i!==t))},P=t=>{window.confirm("Are you sure you want to remove this refit?")&&n(m.filter((r,i)=>i!==t))};return a.jsxs("form",{onSubmit:L,className:"space-y-6  bg-dark p-6",children:[a.jsx("h2",{className:"text-2xl font-bold ",children:e?"Edit Ship":"Create New Ship"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex gap-4",children:[a.jsx("div",{className:"flex-1",children:a.jsx(S,{label:"Ship Name",value:d,onChange:t=>{k(t.target.value),f(null)},required:!0,placeholder:"Enter ship name",error:x?" ":""})}),a.jsx("div",{className:"flex items-end",children:a.jsx(b,{"aria-label":"Fetch ship data",type:"button",variant:"primary",onClick:t=>{t.preventDefault(),M()},disabled:!d||q,className:"relative",children:q?a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"opacity-0",children:"Fetch Data"}),a.jsx("div",{className:"absolute inset-0 flex items-center justify-center",role:"status",children:a.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"})})]}):"Fetch Data"})})]}),x&&a.jsx("div",{className:"text-red-500 text-sm mt-1",children:x})]}),a.jsxs("div",{className:"flex flex-row flex-wrap gap-4",children:[a.jsx($,{label:"Faction",value:O,onChange:t=>C(t),options:l,noDefaultSelection:!0,defaultOption:"Select Faction"}),a.jsx($,{label:"Type",value:D,onChange:t=>N(t),options:T,noDefaultSelection:!0,defaultOption:"Select Type"}),a.jsx($,{label:"Affinity",value:E||"",onChange:t=>A(t),options:le,noDefaultSelection:!0,defaultOption:"Select Affinity"})]}),a.jsx($,{label:"Rarity",value:R,onChange:t=>I(t),options:y,noDefaultSelection:!0,defaultOption:"Select Rarity"}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("h3",{className:"text-lg font-medium ",children:"Base Stats"}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.entries(F).map(([t,r])=>t!=="healModifier"&&a.jsx(S,{type:"number",label:W[t].label,value:r,onChange:i=>h(j=>({...j,[t]:Number(i.target.value)})),min:"0"},t))})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("h3",{className:"text-lg font-medium ",children:"Refits"}),m==null?void 0:m.map((t,r)=>a.jsxs("div",{className:"p-4 border border-gray-700  space-y-4 relative",children:[a.jsx("div",{className:"absolute top-2 right-4",children:a.jsx(b,{"aria-label":"Delete refit",variant:"danger",onClick:()=>P(r),children:a.jsx(U,{})})}),a.jsx(_,{stats:t.stats,onChange:i=>{const j=[...m];j[r]={...t,stats:i},n(j)},maxStats:2})]},r)),(m==null?void 0:m.length)<6&&a.jsx(b,{"aria-label":"Add refit",type:"button",variant:"primary",onClick:()=>n([...m,{stats:[]}]),children:"Add Refit"})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("h3",{className:"text-lg font-medium ",children:"Implants"}),o==null?void 0:o.map((t,r)=>a.jsxs("div",{className:"p-4 border border-gray-700  space-y-4 relative",children:[a.jsx("div",{className:"absolute top-2 right-4",children:a.jsx(b,{"aria-label":"Delete implant",variant:"danger",onClick:()=>v(r),children:a.jsx(U,{})})}),a.jsx(_,{stats:t.stats,onChange:i=>{const j=[...o];j[r]={...t,stats:i},p(j)},maxStats:2})]},r)),(o==null?void 0:o.length)<5&&a.jsx(b,{"aria-label":"Add implant",type:"button",variant:"primary",onClick:()=>p([...o,{stats:[]}]),children:"Add Implant"})]}),a.jsx("div",{className:"flex justify-end pt-4",children:a.jsx(b,{"aria-label":e?"Save Changes":"Create Ship",type:"submit",children:e?"Save Changes":"Create Ship"})})]})},pe=({ship:s,allShips:e,hoveredGear:d,availableGear:k,getGearPiece:F,onEdit:h,onRemove:O,onLockEquipment:C,onEquipGear:D,onRemoveGear:N,onHoverGear:R,onUnequipAll:I,variant:m="full"})=>{var T;const[n,o]=c.useState(null),[p,q]=c.useState(!1),[u,x]=c.useState(null),{addNotification:f}=B(),w=ae(s.equipment,F),E=te(s.equipment,w),A=()=>{I(s.id),f("success",`Unequipped all gear on ${s.name}`)},L=l=>{const y=e.find(v=>v.equipmentLocked&&v.id!==s.id&&Object.values(v.equipment).includes(l.id));if(y){f("error",`This gear is locked to ${y.name}. Please unlock the ship's equipment first.`);return}l.shipId&&l.shipId!==s.id?(x(l),q(!0)):n&&(D(s.id,n,l.id),o(null),f("success",`Equipped ${l.slot} on ${s.name}`))},M=()=>{u&&n&&(D(s.id,n,u.id),o(null),f("success",`Equipped ${u.slot} on ${s.name}`),x(null))};return a.jsxs(a.Fragment,{children:[a.jsx(Z,{ship:s,onEdit:h,onRemove:O,onLockEquipment:C,variant:m,children:a.jsxs("div",{className:"p-4 bg-dark",children:[a.jsx("div",{className:"grid grid-cols-3 gap-2 w-fit mx-auto",children:Object.entries(Y).map(([l,y])=>a.jsx(g,{slotKey:l,gear:w[s.equipment[l]||""],hoveredGear:d,onSelect:o,onRemove:v=>N(s.id,v),onHover:R},l))}),a.jsxs("div",{className:"flex items-center gap-2 pt-3",children:[E&&a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"text-xs text-gray-400",children:"Gear Sets:"}),E.map((l,y)=>a.jsx("img",{src:J[l].iconUrl,alt:l,className:"w-5"},`${l}-${y}`))]}),Object.values(s.equipment)&&a.jsx(b,{"aria-label":"Unequip all gear",className:"ml-auto",variant:"secondary",size:"xs",onClick:A,children:"Unequip All"})]})]})}),a.jsx(Q,{isOpen:n!==null,onClose:()=>o(null),title:`Select ${n} for ${s.name}`,children:a.jsx(ee,{inventory:k.filter(l=>n&&l.slot===n),mode:"select",onEquip:L,onRemove:()=>{},onEdit:()=>{}})}),a.jsx(V,{isOpen:p,onClose:()=>{q(!1),x(null)},onConfirm:M,title:"Move Gear",message:`This ${u==null?void 0:u.slot} is currently equipped on ${((T=e.find(l=>l.id===(u==null?void 0:u.shipId)))==null?void 0:T.name)||"another ship"}. Would you like to move it to ${s.name} instead?`,confirmLabel:"Move",cancelLabel:"Cancel"})]})};export{pe as S,de as a};
