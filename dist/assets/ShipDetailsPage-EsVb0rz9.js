import{e as w,l as n,G as L,j as t,L as P,T as O,u as M,P as B,h as _}from"./ui-D2YqbPcu.js";import{a as g,h as q,i as $}from"./vendor-BhvhDhpY.js";import{a as G,S as H}from"./ShipCard-zRCvJgFU.js";import{S as k}from"./StatDisplay-zLjdPrVG.js";import{c as A,u as Y,a as K}from"./useShips-RXMfKXLW.js";import{u as W}from"./useEngineeringStats-BBMilB8n.js";import{a as D}from"./scoring-AiKeAj3b.js";import{u as z,b as V}from"./useGear-BHcAIW33.js";import"./ships-data-B9_KdinZ.js";import"./StatModifierInput-CjKO7zbw.js";import"./ShipDisplay-ApR9I5gC.js";import"./GearSlot-BtS1uLEJ.js";import"./GearPieceDisplay-BCww8SQc.js";import"./GearInventory-YrEp50QN.js";import"./useStorage-6AZ-_ceW.js";import"./firebaseStorage-B0eyI6ev.js";function F(i,l,a,c){const v=D(a,i,[],l,c,w[a.type].name),f=A(a.baseStats,i,l,a.refits,a.implants,c(a.type)).final,p=[];let e=0;return Object.entries(n).forEach(([o])=>{const r=i[o];if(!r||!l(r))return;const u={...i};delete u[o];const y=D(a,u,[],l,c,w[a.type].name),b=v-y;e+=Math.max(0,b);const h=A(a.baseStats,u,l,a.refits,a.implants,c(a.type)).final,d=[];Object.entries(f).forEach(([x,s])=>{const j=h[x]||0,E=s-j;if(E!==0){const R=E/(s-a.baseStats[x])*100;d.push({statName:x,value:E,percentage:isFinite(R)?R:0})}}),p.push({slotName:o,absoluteScore:b,relativeScore:0,primaryStats:d.filter(x=>x.value!==0).sort((x,s)=>Math.abs(s.percentage)-Math.abs(x.percentage))})}),p.forEach(o=>{o.relativeScore=e>0?Math.max(0,o.absoluteScore)/e*100:0}),p.sort((o,r)=>r.absoluteScore-o.absoluteScore)}const Q={ATTACKER:["crit","critDamage","attack","speed"],DEFENDER:["hp","defence","security"],SUPPORTER:["hp","crit","critDamage","healModifier"],SUPPORTER_BUFFER:["speed","hp","defence"],DEBUFFER:["hacking","speed","attack","crit","critDamage"]};function X(i,l){return l.crit<95&&!i.subStats.some(a=>a.name==="crit")?{title:"Low crit rate",reason:"Consider finding a new piece with more crit rate substats"}:null}function J(i,l,a,c,v){const f=Q[l.type],p=i.subStats.filter(m=>f.includes(m.name)),e={reasons:[]};["epic","legendary"].includes(i.rarity)||e.reasons.push({title:"Low rarity",reason:`An epic or legendary ${i.slot} piece would have more substats`}),i.stars<=4&&e.reasons.push({title:"Low stars",reason:`A higher star ${i.slot} piece would have more main stat`}),p.length<2&&e.reasons.push({title:"Low relevant substat count",reason:`Only ${p.length} relevant substat${p.length===1?"":"s"}`});const o=Object.values(l.equipment).filter(m=>{var u;return m&&((u=c(m))==null?void 0:u.setBonus)==="boost"}).length,r=X(i,a);switch(l.type){case"SUPPORTER":i.setBonus!=="repair"&&e.reasons.push({title:"Not a repair piece",reason:`Consider finding a new ${i.slot} with the repair set`});case"ATTACKER":case"DEBUFFER":r&&e.reasons.push(r);break;case"SUPPORTER_BUFFER":o<4&&i.setBonus!=="boost"&&v.relativeScore<n[i.slot].expectedContribution&&e.reasons.push({title:"Boost set bonus not found",reason:"Consider investing in the Boost set for boosters."});break}return e}const U={ATTACKER:["ATTACK","CRITICAL","ABYSSAL_ASSULT","AMBUSH"],DEFENDER:["DEFENSE","FORTITUDE","ABYSSAL_SAFEGUARD","ABYSSAL_WARD","PROTECTION"],SUPPORTER:["REPAIR","FORTITUDE","CRITICAL","ABYSSAL_SAFEGUARD"],SUPPORTER_BUFFER:["BOOST","SPEED","FORTITUDE","AMBUSH"],DEBUFFER:["HACKING","ABYSSAL_BREACH","ATTACK","CRITICAL","ABYSSAL_ASSULT","AMBUSH"]};function Z(i,l,a,c,v,f){const p=[];return i.forEach(e=>{const o=l[e.slotName];if(!o)return;const r=a(o);if(!r)return;const m=r.setBonus&&U[c.type].includes(r.setBonus);if(e.relativeScore<n[e.slotName].expectedContribution-1){const h=J(r,c,v,a,e);p.push({slotName:e.slotName,currentLevel:r.level,priority:e.relativeScore,reasons:h.reasons||"Consider replacing this piece with a piece with more contribution"})}const u=["sensor","software","thrusters"].includes(e.slotName),y=n[e.slotName].expectedContribution,b=p.find(h=>h.slotName===e.slotName);if(r.level<16){const h=e.relativeScore;let d;u&&h<y?d=`${n[e.slotName].label} provides percentage-based stats but is underperforming`:!u&&r.level<12?d="Level up to increase flat stat bonus":d="Minor improvements available",b?b.reasons.push({title:"Low level",reason:d}):p.push({slotName:e.slotName,currentLevel:r.level,priority:e.relativeScore,reasons:[{title:"Low level",reason:d}]})}if(f.length>0&&!m){const h=f.filter(d=>d.setBonus!==r.setBonus);if(h.length>0){const d=h.reduce((x,s)=>s.setBonus&&U[c.type].includes(s.setBonus)?s:x,h[0]);b?b.reasons.push({title:"Not optimal set bonus",reason:`Switching to a ${L[d.setBonus].name} ${n[e.slotName].label} could improve your score, as it will provide an extra set bonus`}):p.push({slotName:e.slotName,currentLevel:r.level,reasons:[{title:"Not optimal set bonus",reason:`Switching to a ${L[d.setBonus].name} ${n[e.slotName].label} could improve your score, as it will provide an extra set bonus`}]})}}}),p.sort((e,o)=>e.priority!==void 0&&o.priority!==void 0&&n[e.slotName].expectedContribution-e.priority!==n[o.slotName].expectedContribution-o.priority?n[o.slotName].expectedContribution-o.priority-(n[e.slotName].expectedContribution-e.priority):e.priority===void 0||o.priority===void 0?-1:0)}const ee=({suggestions:i})=>{const[l,a]=g.useState({}),[c,v]=g.useState({}),f=(e,o)=>{v(r=>({...r,[e]:o})),a(r=>({...r,[e]:!0}))},p=e=>{a(o=>({...o,[e]:!1}))};return i.length===0?null:t.jsxs("section",{className:"bg-dark p-4",children:[t.jsx("h3",{className:"font-semibold",children:"Upgrade Suggestions (EXPERIMENTAL)"}),t.jsx("p",{className:"text-xs text-gray-400 mb-4",children:t.jsx("span",{children:"These are suggestions for upgrading your gear, based on the gear contribution and the ship's final score."})}),t.jsx("div",{className:"space-y-3",children:i.map(e=>t.jsxs("div",{className:`p-3 border-l-4 ${e.priority<n[e.slotName].expectedContribution-5?"border-red-500 bg-red-900/20":e.priority<n[e.slotName].expectedContribution-2?"border-yellow-500 bg-yellow-900/20":"border-blue-500 bg-blue-900/20"}`,children:[t.jsxs("div",{className:"mb-1 flex flex-wrap",children:[t.jsx("span",{className:"font-medium",children:n[e.slotName].label}),e.currentLevel!==16&&t.jsxs("span",{className:"text-sm ml-auto",children:["Level ",e.currentLevel," â†’ 16"]}),e.priority&&t.jsxs("span",{className:"block text-xs w-full",children:[e.priority.toFixed(1),"% is a"," ",e.priority<n[e.slotName].expectedContribution-5?"very":e.priority<n[e.slotName].expectedContribution-2?"":"fairly"," ","low contribution for a ",n[e.slotName].label," ","piece"]})]}),t.jsx("ul",{className:"text-sm text-gray-400 list-disc ml-4",children:e.reasons.map((o,r)=>{const m=`${e.slotName}-${r}`;return t.jsxs("li",{children:[t.jsxs("span",{className:"text-xs inline-flex items-center",onMouseEnter:()=>f(m,o.reason),onMouseLeave:()=>p(m),children:[o.title," ",t.jsx(P,{})]}),t.jsx(O,{isVisible:l[m]||!1,children:t.jsx("span",{className:"text-gray-400 bg-dark-lighter p-2 border border-gray-300 block",children:c[m]})})]},r)})})]},e.slotName))})]})},te=({contributions:i})=>!i||i.length===0?null:t.jsxs("div",{className:"p-4 bg-dark",children:[t.jsx("h3",{className:"font-semibold",children:"Gear Contribution"}),t.jsx("p",{className:"text-xs text-gray-400 mb-4",children:"The chart below shows the relative contribution of each gear piece and its stats to the ship's final score. Score is calculated differently for each ship type."}),i.map(l=>t.jsxs("div",{className:"mb-3",children:[t.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[t.jsx("span",{children:n[l.slotName].label}),t.jsxs("span",{className:"text-gray-400",children:[l.relativeScore>.1?l.relativeScore.toFixed(1):"<0.1","%"]})]}),t.jsx("div",{className:"w-full bg-dark-lighter h-2 overflow-hidden",children:t.jsx("div",{className:"h-full bg-blue-500",style:{width:`${Math.max(0,Math.min(100,l.relativeScore))}%`}})}),t.jsx("div",{className:"mt-1 text-xs text-gray-400 flex flex-wrap gap-2",children:l.primaryStats.filter(a=>a.percentage>=.1).sort((a,c)=>c.percentage-a.percentage).map(a=>t.jsxs("span",{children:[a.statName,":"," ",a.percentage>.1?a.percentage.toFixed(1):"<0.1","%"]},a.statName))})]},l.slotName))]}),ve=()=>{const[i,l]=g.useState(null),[a,c]=g.useState(!1),[v,f]=g.useState(void 0),{shipId:p}=q(),e=$(),{inventory:o,getGearPiece:r}=Y(),{ships:m,updateShip:u,handleRemoveShip:y,handleLockEquipment:b,handleUnequipAllGear:h}=K({getGearPiece:r}),{getEngineeringStatsForShipType:d}=W(),{addNotification:x}=M(),s=m.find(S=>S.id===p),j=z((s==null?void 0:s.equipment)||{},r),E=V(s||{},j);if(!s)return t.jsx(B,{title:"Ship Not Found",action:{label:"Back to Ships",onClick:()=>e("/ships"),variant:"secondary"},children:t.jsx("div",{className:"text-center text-gray-400",children:"The requested ship could not be found."})});const R=F(s.equipment,r,s,d),I=Z(R,s.equipment,r,s,A(s.baseStats,s.equipment,r,s.refits,s.implants,d(s.type)).final,E);return t.jsxs(B,{title:`${s.name} Details`,action:{label:"Back to Ships",onClick:()=>e("/ships"),variant:"secondary"},children:[t.jsx(_,{isVisible:a||!!v,children:t.jsx(G,{onSubmit:async S=>{await u(S),c(!1),window.scrollTo({top:0,behavior:"smooth"}),f(void 0),x("success","Ship saved successfully")},editingShip:v})}),t.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"space-y-6",children:[t.jsx(H,{variant:"extended",ship:s,allShips:m,hoveredGear:i,availableGear:o,getGearPiece:r,onRemove:S=>{y(S),e("/ships")},onLockEquipment:async S=>{await b(S)},onEquipGear:(S,N,T)=>{const C={...s};C.equipment[N]=T,u(C)},onRemoveGear:(S,N)=>{const T={...s};delete T.equipment[N],u(T)},onUnequipAll:()=>{h(s.id)},onHoverGear:l,onEdit:()=>{c(!0),f(s),window.scrollTo({top:0,behavior:"smooth"})}}),t.jsxs("section",{className:"bg-dark p-4",children:[t.jsxs("h3",{className:"mb-4",children:["Refits (",s.refits.length,"/6)"]}),s.refits.length>0?t.jsx("div",{className:"space-y-2",children:s.refits.map((S,N)=>t.jsx(k,{stats:S.stats,className:"p-2 bg-dark-lighter"},N))}):t.jsx("p",{className:"text-gray-400",children:"No refits installed"})]}),t.jsxs("section",{className:"bg-dark p-4",children:[t.jsxs("h3",{className:"mb-4",children:["Implants (",s.implants.length,")"]}),s.implants.length>0?t.jsx("div",{className:"space-y-2",children:s.implants.map((S,N)=>t.jsx(k,{stats:S.stats,className:"p-2 bg-dark-lighter"},N))}):t.jsx("p",{className:"text-gray-400",children:"No implants installed"})]})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsx(te,{contributions:F(s.equipment,r,s,d)}),t.jsx(ee,{suggestions:I})]})]})]})};export{ve as ShipDetailsPage,ve as default};
