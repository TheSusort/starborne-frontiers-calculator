import{F as u,e as d,s as z,R as J,f as q,j as r,u as K,P as Q,h as W,i as X}from"./ui-D2YqbPcu.js";import{a as l}from"./vendor-BhvhDhpY.js";import{S as Z,a as ee}from"./ShipCard-zRCvJgFU.js";import{u as B,a as te}from"./useShips-RXMfKXLW.js";import{u as se,F as ae}from"./GearInventory-YrEp50QN.js";import"./ships-data-B9_KdinZ.js";import"./StatModifierInput-CjKO7zbw.js";import"./ShipDisplay-ApR9I5gC.js";import"./useEngineeringStats-BBMilB8n.js";import"./useStorage-6AZ-_ceW.js";import"./firebaseStorage-B0eyI6ev.js";import"./GearSlot-BtS1uLEJ.js";import"./GearPieceDisplay-BCww8SQc.js";import"./StatDisplay-zLjdPrVG.js";import"./useGear-BHcAIW33.js";const ie=({ships:n,onRemove:p,onEdit:h,onEquipGear:w,onRemoveGear:x,onLockEquipment:o,onUnequipAll:y,availableGear:R})=>{var I,M,k;const[C,T]=l.useState(null),[f,O]=l.useState(!1),{state:s,setState:m,clearFilters:A}=se("ship-inventory-filters"),g=(((I=s.filters.factions)==null?void 0:I.length)??0)>0||(((M=s.filters.shipTypes)==null?void 0:M.length)??0)>0||(((k=s.filters.rarities)==null?void 0:k.length)??0)>0,N=t=>{m(e=>({...e,filters:{...e.filters,factions:t}}))},P=t=>{m(e=>({...e,filters:{...e.filters,shipTypes:t}}))},v=t=>{m(e=>({...e,filters:{...e.filters,rarities:t}}))},E=t=>{m(e=>({...e,sort:t}))},b=l.useMemo(()=>n.filter(t=>{var S,L,D,H,$,V;const e=(((S=s.filters.factions)==null?void 0:S.length)??0)===0||(((L=s.filters.factions)==null?void 0:L.includes(t.faction))??!1),a=(((D=s.filters.shipTypes)==null?void 0:D.length)??0)===0||(((H=s.filters.shipTypes)==null?void 0:H.includes(t.type))??!1),F=((($=s.filters.rarities)==null?void 0:$.length)??0)===0||(((V=s.filters.rarities)==null?void 0:V.includes(t.rarity))??!1);return e&&a&&F}),[n,s.filters]),i=l.useMemo(()=>{const t=new Set(n.map(e=>e.faction));return Array.from(t).sort((e,a)=>u[e].name.localeCompare(u[a].name))},[n]),c=l.useMemo(()=>{const t=new Set(n.map(e=>e.type));return Array.from(t).sort((e,a)=>d[e].name.localeCompare(d[a].name))},[n]),G=l.useMemo(()=>{const t=new Set(n.map(e=>e.rarity));return z(Array.from(t))},[n]),{getGearPiece:U}=B(),Y=[{id:"faction",label:"Factions",values:s.filters.factions??[],onChange:N,options:i.map(t=>({value:t,label:u[t].name}))},{id:"shipType",label:"Ship Type",values:s.filters.shipTypes??[],onChange:P,options:c.map(t=>({value:t,label:d[t].name}))},{id:"rarity",label:"Rarity",values:s.filters.rarities??[],onChange:v,options:G.map(t=>({value:t,label:J[t].label}))}],_=[{value:"id",label:"Date Added"},{value:"name",label:"Name"},{value:"type",label:"Type"},{value:"faction",label:"Faction"},{value:"rarity",label:"Rarity"},{value:"gearCount",label:"Gear"}],j=l.useMemo(()=>[...b].sort((e,a)=>{switch(s.sort.field){case"type":return s.sort.direction==="asc"?d[e.type].name.localeCompare(d[a.type].name):d[a.type].name.localeCompare(d[e.type].name);case"faction":return s.sort.direction==="asc"?u[e.faction].name.localeCompare(u[a.faction].name):u[a.faction].name.localeCompare(u[e.faction].name);case"rarity":return s.sort.direction==="asc"?q.indexOf(a.rarity)-q.indexOf(e.rarity):q.indexOf(e.rarity)-q.indexOf(a.rarity);case"gearCount":{const F=Object.values(e.equipment).filter(Boolean).length,S=Object.values(a.equipment).filter(Boolean).length;return s.sort.direction==="asc"?F-S:S-F}case"name":return s.sort.direction==="asc"?e.name.localeCompare(a.name):a.name.localeCompare(e.name);default:return s.sort.direction==="asc"?e.id.localeCompare(a.id):a.id.localeCompare(e.id)}}),[b,s.sort]);return r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex flex-col",children:[j.length>0&&r.jsxs("span",{className:"text-sm text-gray-400 ",children:["Showing ",j.length," ships"]}),r.jsx(ae,{filters:Y,isOpen:f,onToggle:()=>O(!f),onClear:A,hasActiveFilters:g,sortOptions:_,sort:s.sort,setSort:E})]}),j.length===0?r.jsx("div",{className:"text-center py-8 text-gray-400 bg-dark-lighter  border-2 border-dashed",children:n.length===0?"No ships created yet":"No matching ships found"}):r.jsx(r.Fragment,{children:r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:j.map(t=>r.jsx(Z,{ship:t,allShips:n,hoveredGear:C,availableGear:R,getGearPiece:U,onEdit:h,onRemove:p,onLockEquipment:o,onEquipGear:w,onRemoveGear:x,onUnequipAll:y,onHoverGear:T},t.id))})})]})},xe=()=>{const{inventory:n}=B(),[p,h]=l.useState(!1),[w,x]=l.useState(!1),[o,y]=l.useState(null),R=l.useCallback(i=>n.find(c=>c.id===i),[n]),{ships:C,loading:T,editingShip:f,handleRemoveShip:O,handleEquipGear:s,handleRemoveGear:m,handleSaveShip:A,setEditingShip:g,handleLockEquipment:N,handleUnequipAllGear:P}=te({getGearPiece:R}),{addNotification:v}=K(),E=async i=>{y(C.find(c=>c.id===i)||null),x(!0)},b=async()=>{if(!o)return;const i=Object.entries(o.equipment).map(([c,G])=>G?m(o.id,c):Promise.resolve());await Promise.all(i),await O(o.id),v("success","Ship removed successfully"),y(null)};return T?r.jsx("div",{className:"flex items-center justify-center",children:r.jsx("div",{className:"animate-pulse text-xl",children:"Loading ships..."})}):r.jsxs(Q,{title:"Ship Management",description:"Manage your ships and their equipment.",action:{label:p?"Hide Form":"Create",onClick:()=>{f&&g(void 0),h(!p)},variant:p?"secondary":"primary"},children:[r.jsx(W,{isVisible:p||!!f,children:r.jsx(ee,{onSubmit:async i=>{await A(i),h(!1),window.scrollTo({top:0,behavior:"smooth"}),g(void 0),v("success","Ship saved successfully")},editingShip:f})}),r.jsx(ie,{ships:C,onRemove:E,onEdit:i=>{g(i),h(!0),window.scrollTo({top:0,behavior:"smooth"})},onLockEquipment:async i=>{const c=await N(i);v("success",`Equipment lock state on ${i.name} set to ${c}`)},onEquipGear:s,onRemoveGear:m,onUnequipAll:P,availableGear:n}),r.jsx(X,{isOpen:w,onClose:()=>{x(!1),y(null)},onConfirm:b,title:"Delete Ship",message:o!=null&&o.equipment&&Object.values(o.equipment).some(i=>i)?`This ship has equipped gear that will be unequipped. Are you sure you want to delete ${o.name}?`:`Are you sure you want to delete ${o==null?void 0:o.name}?`,confirmLabel:"Delete",cancelLabel:"Cancel"})]})};export{xe as ShipsPage,xe as default};
