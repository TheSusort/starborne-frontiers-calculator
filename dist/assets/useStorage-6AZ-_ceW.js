import{a as e}from"./vendor-BhvhDhpY.js";import{y as S,u as p}from"./ui-D2YqbPcu.js";import{f as u}from"./firebaseStorage-B0eyI6ev.js";function N(g){const{key:o,defaultValue:c}=g,{user:t}=S(),[l,i]=e.useState(()=>{const a=localStorage.getItem(o);if(a)try{const r=JSON.parse(a);if(Array.isArray(r)&&r.length>0)return r}catch(r){console.error("Error parsing local data:",r)}return c}),[y,d]=e.useState(!0),{addNotification:n}=p(),f=e.useRef(t==null?void 0:t.uid),s=e.useCallback(async()=>{d(!0);try{if(t!=null&&t.uid){const a=await u.getUserData(t.uid);if(a!=null&&a[o]){const r=a[o];i(r),localStorage.setItem(o,JSON.stringify(r))}}}catch(a){console.error("Error loading data:",a),n("error","Failed to load data")}finally{d(!1)}},[o,t==null?void 0:t.uid,n]);e.useEffect(()=>{f.current!==(t==null?void 0:t.uid)&&(t?s():(localStorage.removeItem(o),i(c)),f.current=t==null?void 0:t.uid)},[t,s,o,c]),e.useEffect(()=>{s()},[]);const m=async a=>{try{localStorage.setItem(o,JSON.stringify(a)),i(a),t!=null&&t.uid&&await u.saveUserData(t.uid,{[o]:a})}catch(r){console.error("Error saving data:",r),n("error","Failed to save to cloud storage")}};return{data:l,setData:a=>m(typeof a=="function"?a(l):a),loading:y,reload:s}}export{N as u};
