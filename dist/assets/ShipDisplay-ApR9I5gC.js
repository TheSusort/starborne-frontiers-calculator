import{j as e,k,e as N,F as v,R as y,B as $,Y as C,Z as E,$ as w,L as D,a0 as P,a1 as V,E as M,C as T}from"./ui-D2YqbPcu.js";import{a as j,i as L,L as R}from"./vendor-BhvhDhpY.js";import{u as A,c as O}from"./useShips-RXMfKXLW.js";import{u as G}from"./useEngineeringStats-BBMilB8n.js";const z=["crit","critDamage","healModifier"],B=({stats:s,comparisonStats:t,title:n,className:c=""})=>{const o=["hp","attack","defence","hacking","security","crit","critDamage","speed","healModifier"];return e.jsxs("div",{className:`bg-dark space-y-2 ${c}`,"data-testid":"stat-list",children:[n&&e.jsx("h3",{className:"text-lg font-semibold",children:n}),o.map(a=>{const l=s[a];if(a==="healModifier"&&l<=0)return null;const r=t==null?void 0:t[a],d=r!==void 0?l-r:void 0;return e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"capitalize",children:k[a].label}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{children:[Math.round(l),z.includes(a)?"%":""]}),d!==void 0&&d!==0&&e.jsxs("span",{className:d>0?"text-green-500":"text-red-500",children:["(",d>0?"+":"",Math.round(d),")"]})]})]},a)})]})},u=(s,t)=>{const n={};return Object.keys(s).forEach(c=>{const o=c,a=s[o]||0,l=t[o]||0,r=a-l;r!==0&&(n[o]=r)}),n},b=s=>(s=Math.round(s),s>0?`+${s}`:s.toString()),F=({breakdown:s})=>{const t=["hp","attack","defence","hacking","security","crit","critDamage","speed","healModifier"],n=u(s.afterRefits,s.base),c=u(s.afterEngineering,s.afterRefits),o=u(s.afterGear,s.afterEngineering),a=u(s.afterSets,s.afterGear),l=u(s.final,s.afterSets);return e.jsx("div",{className:"pb-4",children:e.jsxs("table",{className:"w-full text-xs table-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-600 text-left",children:[e.jsx("th",{className:"font-bold p-1 border-r border-gray-600",children:"Stat"}),e.jsx("th",{className:"font-bold p-1",children:"Base"}),e.jsx("th",{className:"font-bold p-1",children:"Refits"}),e.jsx("th",{className:"font-bold p-1 border-r border-gray-600",children:"Eng."}),e.jsx("th",{className:"font-bold p-1",children:"Gear"}),e.jsx("th",{className:"font-bold p-1",children:"Sets"}),e.jsx("th",{className:"font-bold p-1",children:"Impl."}),e.jsx("th",{className:"font-bold p-1 border-l border-gray-600",children:"Final"})]})}),e.jsx("tbody",{children:t.map(r=>{const d=s.base[r]||0,x=n[r],m=c[r],f=o[r],p=a[r],i=l[r],g=s.final[r];return!d&&!x&&!m&&!f&&!p&&!i&&!g?null:e.jsxs("tr",{className:`${r!=="speed"?"border-b border-gray-600":""}`,children:[e.jsx("td",{className:"p-1 border-r border-gray-600",children:k[r].shortLabel}),e.jsx("td",{className:"p-1 text-gray-400",children:d||"-"}),e.jsx("td",{className:`p-1 ${x?"text-yellow-400":""}`,children:x?b(x):"-"}),e.jsx("td",{className:`p-1 border-r border-gray-600 ${m?"text-blue-400":""}`,children:m?b(m):"-"}),e.jsx("td",{className:`p-1 ${f?"text-green-400":""}`,children:f?b(f):"-"}),e.jsx("td",{className:`p-1 ${p?"text-emerald-400":""}`,children:p?b(p):"-"}),e.jsx("td",{className:`p-1 ${i?"text-purple-400":""}`,children:i?b(i):"-"}),e.jsx("td",{className:"p-1 border-l border-gray-600",children:g?Math.round(g):"-"})]},r)})})]})})},U=({onClick:s,children:t,className:n=""})=>e.jsx("button",{className:`w-full text-left px-4 py-2 hover:bg-dark-lighter ${n}`,onClick:s,children:t}),h=({trigger:s,children:t,align:n="right"})=>{const[c,o]=j.useState(!1),a=j.useRef(null);return j.useEffect(()=>{const l=r=>{a.current&&!a.current.contains(r.target)&&o(!1)};return document.addEventListener("mousedown",l),()=>document.removeEventListener("mousedown",l)},[]),e.jsxs("div",{className:"relative",ref:a,children:[e.jsx("div",{onClick:l=>{l.stopPropagation(),o(!c)},children:s}),c&&e.jsx("div",{className:`absolute z-50 mt-2 ${n==="right"?"right-0":"left-0"} min-w-[200px] bg-dark border border-dark-border rounded shadow-lg`,onClick:l=>l.stopPropagation(),children:t})]})};h.Item=U;const I=j.memo(({iconUrl:s,name:t,className:n})=>e.jsx("img",{src:s,alt:t,className:`w-4 ${n}`}));I.displayName="ShipImage";const _=({affinity:s})=>{switch(s){case"chemical":return"filter-chemical";case"electric":return"filter-electric";case"thermal":return"filter-thermal";case"antimatter":return"filter-antimatter";default:return""}},S=j.memo(({ship:s,variant:t="full"})=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1 min-h-[28px]",children:[s.type&&N[s.type]&&e.jsx(I,{iconUrl:N[s.type].iconUrl,name:N[s.type].name,className:`${s.affinity?_({affinity:s.affinity}):""}`}),s.faction&&v[s.faction]&&e.jsx(I,{iconUrl:v[s.faction].iconUrl,name:v[s.faction].name}),e.jsx("span",{className:`${t==="compact"?"text-sm":"lg:text-sm"} font-secondary ${y[s.rarity||"common"].textColor}`,children:s.name})]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:6},(n,c)=>e.jsx("span",{className:`text-xs tracking-tightest ${c<s.refits.length?"text-yellow-400":"text-gray-300"}`,children:"â˜…"},c))})]}));S.displayName="Header";const H=j.memo(({ship:s,variant:t="full",onEdit:n,onRemove:c,selected:o,onClick:a,children:l,onLockEquipment:r})=>{var p;const{getGearPiece:d}=A(),{getEngineeringStatsForShipType:x}=G(),m=L(),f=j.useMemo(()=>O(s.baseStats,s.equipment,d,s.refits,s.implants,x(s.type)),[s.baseStats,s.equipment,d,s.refits,s.implants,x,s.type]);return t==="compact"?e.jsxs("div",{className:`flex-grow p-3 bg-dark border ${y[s.rarity||"common"].borderColor} ${o?"border-2":""} ${a?"cursor-pointer hover:bg-dark-lighter":""}`,onClick:a,children:[e.jsx(S,{ship:s,variant:"compact"}),l]}):e.jsxs("div",{className:`flex flex-col flex-grow bg-dark border ${y[s.rarity||"common"].borderColor} ${o?"border-2":""} ${a?"cursor-pointer hover:bg-dark-lighter":""}`,onClick:a,children:[e.jsxs("div",{className:`px-4 py-2 border-b ${y[s.rarity||"common"].borderColor} flex justify-between items-center`,children:[e.jsx(S,{ship:s}),(n||c||r)&&e.jsxs("div",{className:"flex gap-1",children:[r&&e.jsx($,{variant:"secondary",size:"sm",onClick:async i=>{i.stopPropagation();try{await r(s)}catch(g){console.error("Failed to update lock state:",g)}},children:s.equipmentLocked?e.jsx(C,{}):e.jsx(E,{})}),e.jsxs(h,{trigger:e.jsx($,{variant:"secondary",size:"sm","aria-label":"Ship actions",children:e.jsx(w,{})}),children:[e.jsx(h.Item,{onClick:()=>{},children:e.jsxs(R,{to:`/ships/${s.id}`,className:"flex items-center gap-2",children:[e.jsx(D,{}),e.jsx("span",{children:"Ship info"})]})}),e.jsx(h.Item,{onClick:i=>{i.stopPropagation(),m(`/autogear?shipId=${s.id}`)},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{}),e.jsx("span",{children:"Optimize gear"})]})}),e.jsx(h.Item,{onClick:i=>{i.stopPropagation(),m(`/simulation?shipId=${s.id}`)},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{}),e.jsx("span",{children:"Simulate ship"})]})}),n&&e.jsx(h.Item,{onClick:i=>{i.stopPropagation(),n(s)},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{}),e.jsx("span",{children:"Edit ship"})]})}),c&&e.jsx(h.Item,{onClick:i=>{i.stopPropagation(),c(s.id)},className:"text-red-500",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{}),e.jsx("span",{children:"Remove ship"})]})})]})]})]}),l,e.jsx("div",{className:"px-4 pb-4 relative flex-grow",children:e.jsxs("div",{className:"space-y-1 text-sm",children:[s.implants&&t==="full"&&e.jsxs("div",{className:"flex justify-between text-gray-300 border-b py-1 border-dark-lighter",children:[e.jsx("span",{children:"Implants:"}),e.jsx("span",{children:(p=s.implants)==null?void 0:p.length})]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex-grow",children:[t==="full"&&e.jsx(B,{stats:f.final}),t==="extended"&&e.jsx(F,{breakdown:f})]})})]})})]})});H.displayName="ShipDisplay";export{B as S,H as a};
