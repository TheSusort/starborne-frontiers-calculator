import{j as n,I as ae,B as q,w as oe,u as Y,x as se,E as ce,C as le,S as ue,P as de,h as fe,i as me}from"./ui-D2YqbPcu.js";import{a as U,g as he}from"./vendor-BhvhDhpY.js";import{S as pe}from"./ShipSelector-BxvrfkTU.js";import{a as ge}from"./useShips-RXMfKXLW.js";import{u as ve}from"./useStorage-6AZ-_ceW.js";import"./ShipDisplay-ApR9I5gC.js";import"./useEngineeringStats-BBMilB8n.js";import"./firebaseStorage-B0eyI6ev.js";const xe=({isActive:w,isSelected:m,children:i,className:x="",...P})=>n.jsx("button",{className:`
                w-full aspect-[1.15/1] relative
                transform scale-[1.15]
                ${x}
            `,...P,children:n.jsx("div",{className:`
                    absolute inset-0
                    clip-hex transition-colors duration-200
                    flex items-center justify-center
                    transform rotate-[30deg]
                    ${w?"bg-primary":"bg-dark-lighter"}
                    ${m?"bg-yellow-500":""}
                    hover:bg-white
                `,children:n.jsx("div",{className:"clip-hex transform scale-95 bg-dark w-full h-full",children:n.jsx("div",{className:"transform rotate-[-30deg] w-full h-full flex items-center justify-center",children:i})})})}),Q=({formation:w,onPositionSelect:m,selectedPosition:i,onRemoveShip:x})=>{const{ships:P}=ge(),d=[["T1","T2","T3","T4"],["M1","M2","M3","M4"],["B1","B2","B3","B4"]],g=f=>{const b=w.find(y=>y.position===f);return b?P.find(y=>y.id===b.shipId):null};return n.jsxs("div",{className:"grid p-4 pb-6 ml-[9.5%]",role:"grid",children:[d.map((f,b)=>n.jsx("div",{className:`grid grid-cols-4 ${b===1?"ml-[-12.5%] mr-[12.5%]":""}`,children:f.map(y=>{const S=g(y);return n.jsx(xe,{onClick:L=>{L.ctrlKey||L.metaKey?x==null||x(y):m==null||m(y)},isActive:!!S,isSelected:i===y,children:n.jsxs("div",{className:"flex flex-col items-center",children:[n.jsx("span",{className:"text-xs ",children:y}),S&&n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"text-white text-xs mt-1 px-1 truncate max-w-full",children:S.name}),n.jsx("span",{className:"flex items-center gap-1",children:Array.from({length:6},(L,$)=>n.jsx("span",{className:`text-xs tracking-tightest ${$<S.refits.length?"text-yellow-400":"text-gray-300"}`,children:"â˜…"},$))})]})]})},y)})},b)),x&&n.jsx("div",{className:"text-xs text-gray-400 mt-6",children:"Tip: Ctrl+Click to remove a ship"})]})},ye=({onSubmit:w,initialEncounter:m})=>{const[i,x]=U.useState(""),[P,d]=U.useState([]),[g,f]=U.useState(),[b,y]=U.useState("");U.useEffect(()=>{m?(x(m.name),d(m.formation),y(m.description||"")):(x(""),d([]),y(""))},[m]);const S=A=>{A.preventDefault();const T={id:(m==null?void 0:m.id)||Date.now().toString(),name:i,formation:P,createdAt:(m==null?void 0:m.createdAt)||Date.now(),description:b};w(T),x(""),d([]),y(""),f(void 0)},L=A=>{g&&(d(T=>[...T.filter(X=>X.position!==g),{shipId:A.id,position:g}]),f(void 0))},$=A=>{d(T=>T.filter(D=>D.position!==A)),f(void 0)};return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("form",{onSubmit:S,className:"bg-dark-light space-y-4",children:[n.jsxs("div",{className:"flex items-end space-x-2 w-full",children:[n.jsx(ae,{label:"Encounter Name",type:"text",id:"name",value:i,onChange:A=>x(A.target.value),required:!0}),n.jsxs(q,{type:"submit",variant:"primary",children:[m?"Update":"Save"," Encounter"]})]}),n.jsx(oe,{label:"Description",id:"description",value:b,onChange:A=>y(A.target.value)})]}),n.jsxs("div",{className:"bg-dark-light space-y-4 max-w-[700px] mx-auto py-6",children:[n.jsx(Q,{formation:P,onPositionSelect:f,selectedPosition:g,onRemoveShip:$}),g&&n.jsxs("div",{className:"mt-4",children:[n.jsxs("h3",{className:"text-white text-sm mb-2",children:["Select ship for position ",g,":"]}),n.jsx(pe,{selected:null,onSelect:L,variant:"compact",sortDirection:"desc"})]})]})]})};var W={exports:{}},J;function be(){return J||(J=1,function(w){(function(m){var i=te(),x=ne(),P=re(),d=ie(),g={imagePlaceholder:void 0,cacheBust:!1},f={toSvg:b,toPng:S,toJpeg:L,toBlob:$,toPixelData:y,impl:{fontFaces:P,images:d,util:i,inliner:x,options:{}}};w.exports=f;function b(r,t){return t=t||{},A(t),Promise.resolve(r).then(function(s){return D(s,t.filter,!0)}).then(X).then(Z).then(a).then(function(s){return ee(s,t.width||i.width(r),t.height||i.height(r))});function a(s){return t.bgcolor&&(s.style.backgroundColor=t.bgcolor),t.width&&(s.style.width=t.width+"px"),t.height&&(s.style.height=t.height+"px"),t.style&&Object.keys(t.style).forEach(function(h){s.style[h]=t.style[h]}),s}}function y(r,t){return T(r,t||{}).then(function(a){return a.getContext("2d").getImageData(0,0,i.width(r),i.height(r)).data})}function S(r,t){return T(r,t||{}).then(function(a){return a.toDataURL()})}function L(r,t){return t=t||{},T(r,t).then(function(a){return a.toDataURL("image/jpeg",t.quality||1)})}function $(r,t){return T(r,t||{}).then(i.canvasToBlob)}function A(r){typeof r.imagePlaceholder>"u"?f.impl.options.imagePlaceholder=g.imagePlaceholder:f.impl.options.imagePlaceholder=r.imagePlaceholder,typeof r.cacheBust>"u"?f.impl.options.cacheBust=g.cacheBust:f.impl.options.cacheBust=r.cacheBust}function T(r,t){return b(r,t).then(i.makeImage).then(i.delay(100)).then(function(s){var h=a(r);return h.getContext("2d").drawImage(s,0,0),h});function a(s){var h=document.createElement("canvas");if(h.width=t.width||i.width(s),h.height=t.height||i.height(s),t.bgcolor){var u=h.getContext("2d");u.fillStyle=t.bgcolor,u.fillRect(0,0,h.width,h.height)}return h}}function D(r,t,a){if(!a&&t&&!t(r))return Promise.resolve();return Promise.resolve(r).then(s).then(function(o){return h(r,o,t)}).then(function(o){return u(r,o)});function s(o){return o instanceof HTMLCanvasElement?i.makeImage(o.toDataURL()):o.cloneNode(!1)}function h(o,c,N){var F=o.childNodes;if(F.length===0)return Promise.resolve(c);return E(c,i.asArray(F),N).then(function(){return c});function E(G,I,j){var k=Promise.resolve();return I.forEach(function(H){k=k.then(function(){return D(H,j)}).then(function(B){B&&G.appendChild(B)})}),k}}function u(o,c){if(!(c instanceof Element))return c;return Promise.resolve().then(N).then(F).then(E).then(G).then(function(){return c});function N(){I(window.getComputedStyle(o),c.style);function I(j,k){j.cssText?k.cssText=j.cssText:H(j,k);function H(B,M){i.asArray(B).forEach(function(e){M.setProperty(e,B.getPropertyValue(e),B.getPropertyPriority(e))})}}}function F(){[":before",":after"].forEach(function(j){I(j)});function I(j){var k=window.getComputedStyle(o,j),H=k.getPropertyValue("content");if(H===""||H==="none")return;var B=i.uid();c.className=c.className+" "+B;var M=document.createElement("style");M.appendChild(e(B,j,k)),c.appendChild(M);function e(l,v,p){var C="."+l+":"+v,R=p.cssText?z(p):K(p);return document.createTextNode(C+"{"+R+"}");function z(O){var V=O.getPropertyValue("content");return O.cssText+" content: "+V+";"}function K(O){return i.asArray(O).map(V).join("; ")+";";function V(_){return _+": "+O.getPropertyValue(_)+(O.getPropertyPriority(_)?" !important":"")}}}}}function E(){o instanceof HTMLTextAreaElement&&(c.innerHTML=o.value),o instanceof HTMLInputElement&&c.setAttribute("value",o.value)}function G(){c instanceof SVGElement&&(c.setAttribute("xmlns","http://www.w3.org/2000/svg"),c instanceof SVGRectElement&&["width","height"].forEach(function(I){var j=c.getAttribute(I);j&&c.style.setProperty(I,j)}))}}}function X(r){return P.resolveAll().then(function(t){var a=document.createElement("style");return r.appendChild(a),a.appendChild(document.createTextNode(t)),r})}function Z(r){return d.inlineAll(r).then(function(){return r})}function ee(r,t,a){return Promise.resolve(r).then(function(s){return s.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),new XMLSerializer().serializeToString(s)}).then(i.escapeXhtml).then(function(s){return'<foreignObject x="0" y="0" width="100%" height="100%">'+s+"</foreignObject>"}).then(function(s){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+t+'" height="'+a+'">'+s+"</svg>"}).then(function(s){return"data:image/svg+xml;charset=utf-8,"+s})}function te(){return{escape:G,parseExtension:t,mimeType:a,dataAsUrl:E,isDataUrl:s,canvasToBlob:u,resolveUrl:o,getAndEncode:F,uid:c(),delay:I,asArray:j,escapeXhtml:k,makeImage:N,width:H,height:B};function r(){var e="application/font-woff",l="image/jpeg";return{woff:e,woff2:e,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:l,jpeg:l,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"}}function t(e){var l=/\.([^\.\/]*?)$/g.exec(e);return l?l[1]:""}function a(e){var l=t(e).toLowerCase();return r()[l]||""}function s(e){return e.search(/^(data:)/)!==-1}function h(e){return new Promise(function(l){for(var v=window.atob(e.toDataURL().split(",")[1]),p=v.length,C=new Uint8Array(p),R=0;R<p;R++)C[R]=v.charCodeAt(R);l(new Blob([C],{type:"image/png"}))})}function u(e){return e.toBlob?new Promise(function(l){e.toBlob(l)}):h(e)}function o(e,l){var v=document.implementation.createHTMLDocument(),p=v.createElement("base");v.head.appendChild(p);var C=v.createElement("a");return v.body.appendChild(C),p.href=l,C.href=e,C.href}function c(){var e=0;return function(){return"u"+l()+e++;function l(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}}}function N(e){return new Promise(function(l,v){var p=new Image;p.onload=function(){l(p)},p.onerror=v,p.src=e})}function F(e){var l=3e4;return f.impl.options.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+new Date().getTime()),new Promise(function(v){var p=new XMLHttpRequest;p.onreadystatechange=z,p.ontimeout=K,p.responseType="blob",p.timeout=l,p.open("GET",e,!0),p.send();var C;if(f.impl.options.imagePlaceholder){var R=f.impl.options.imagePlaceholder.split(/,/);R&&R[1]&&(C=R[1])}function z(){if(p.readyState===4){if(p.status!==200){C?v(C):O("cannot fetch resource: "+e+", status: "+p.status);return}var V=new FileReader;V.onloadend=function(){var _=V.result.split(/,/)[1];v(_)},V.readAsDataURL(p.response)}}function K(){C?v(C):O("timeout of "+l+"ms occured while fetching resource: "+e)}function O(V){console.error(V),v("")}})}function E(e,l){return"data:"+l+";base64,"+e}function G(e){return e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")}function I(e){return function(l){return new Promise(function(v){setTimeout(function(){v(l)},e)})}}function j(e){for(var l=[],v=e.length,p=0;p<v;p++)l.push(e[p]);return l}function k(e){return e.replace(/#/g,"%23").replace(/\n/g,"%0A")}function H(e){var l=M(e,"border-left-width"),v=M(e,"border-right-width");return e.scrollWidth+l+v}function B(e){var l=M(e,"border-top-width"),v=M(e,"border-bottom-width");return e.scrollHeight+l+v}function M(e,l){var v=window.getComputedStyle(e).getPropertyValue(l);return parseFloat(v.replace("px",""))}}function ne(){var r=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:h,shouldProcess:t,impl:{readUrls:a,inline:s}};function t(u){return u.search(r)!==-1}function a(u){for(var o=[],c;(c=r.exec(u))!==null;)o.push(c[1]);return o.filter(function(N){return!i.isDataUrl(N)})}function s(u,o,c,N){return Promise.resolve(o).then(function(E){return c?i.resolveUrl(E,c):E}).then(N||i.getAndEncode).then(function(E){return i.dataAsUrl(E,i.mimeType(o))}).then(function(E){return u.replace(F(o),"$1"+E+"$3")});function F(E){return new RegExp(`(url\\(['"]?)(`+i.escape(E)+`)(['"]?\\))`,"g")}}function h(u,o,c){if(N())return Promise.resolve(u);return Promise.resolve(u).then(a).then(function(F){var E=Promise.resolve(u);return F.forEach(function(G){E=E.then(function(I){return s(I,G,o,c)})}),E});function N(){return!t(u)}}}function re(){return{resolveAll:r,impl:{readAll:t}};function r(){return t().then(function(a){return Promise.all(a.map(function(s){return s.resolve()}))}).then(function(a){return a.join(`
`)})}function t(){return Promise.resolve(i.asArray(document.styleSheets)).then(s).then(a).then(function(u){return u.map(h)});function a(u){return u.filter(function(o){return o.type===CSSRule.FONT_FACE_RULE}).filter(function(o){return x.shouldProcess(o.style.getPropertyValue("src"))})}function s(u){var o=[];return u.forEach(function(c){try{i.asArray(c.cssRules||[]).forEach(o.push.bind(o))}catch(N){console.log("Error while reading CSS rules from "+c.href,N.toString())}}),o}function h(u){return{resolve:function(){var c=(u.parentStyleSheet||{}).href;return x.inlineAll(u.cssText,c)},src:function(){return u.style.getPropertyValue("src")}}}}}function ie(){return{inlineAll:t,impl:{newImage:r}};function r(a){return{inline:s};function s(h){return i.isDataUrl(a.src)?Promise.resolve():Promise.resolve(a.src).then(h||i.getAndEncode).then(function(u){return i.dataAsUrl(u,i.mimeType(a.src))}).then(function(u){return new Promise(function(o,c){a.onload=o,a.onerror=c,a.src=u})})}}function t(a){if(!(a instanceof Element))return Promise.resolve(a);return s(a).then(function(){return a instanceof HTMLImageElement?r(a).inline():Promise.all(i.asArray(a.childNodes).map(function(h){return t(h)}))});function s(h){var u=h.style.getPropertyValue("background");return u?x.inlineAll(u).then(function(o){h.style.setProperty("background",o,h.style.getPropertyPriority("background"))}).then(function(){return h}):Promise.resolve(h)}}}})()}(W)),W.exports}var we=be();const Ee=he(we),Pe=({encounters:w,onEdit:m,onDelete:i})=>{const{addNotification:x}=Y(),P=async d=>{const g=document.getElementById(`encounter-${d}`);if(g)try{const f=await Ee.toBlob(g,{filter:b=>b.textContent!==""});await navigator.clipboard.write([new ClipboardItem({"image/png":f})]),x("success","Copied to clipboard!")}catch(f){console.error("Failed to copy image:",f),x("error","Failed to copy image")}};return n.jsxs("div",{className:"space-y-4",children:[n.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"Saved Encounters"}),w.length>0?n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",role:"encounter-list",children:w.map(d=>n.jsxs("div",{id:`encounter-${d.id}`,className:"space-y-4 border border-dark-border bg-dark",role:"article",children:[n.jsxs("div",{className:"flex justify-between items-start py-2 px-4 border-b border-dark-border",children:[n.jsx("h3",{className:"text-lg font-medium text-white",children:d.name}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(q,{variant:"secondary",size:"sm",onClick:()=>P(d.id),"aria-label":"Copy as Image",children:n.jsx(se,{})}),n.jsx(q,{variant:"secondary",size:"sm",onClick:()=>m(d),"aria-label":"Edit Encounter",children:n.jsx(ce,{})}),n.jsx(q,{"aria-label":"Delete Encounter",variant:"danger",size:"sm",onClick:()=>i(d.id),children:n.jsx(le,{})})]})]}),d.description&&n.jsx("p",{className:"text-white text-sm px-4",children:d.description}),n.jsx(Q,{formation:d.formation})]},d.id))}):n.jsx("div",{className:"text-center py-8 text-gray-400 bg-dark-lighter  border-2 border-dashed",children:"No encounters found"})]})},je=ue.ENCOUNTER_NOTES,Ce=()=>{const{data:w=[],setData:m,loading:i}=ve({key:je,defaultValue:[]}),x=U.useCallback(g=>{const f={...g,id:Date.now().toString(),createdAt:Date.now()};m([...w,f])},[w,m]),P=U.useCallback(g=>{const f=w.map(b=>b.id===g.id?g:b);m(f)},[w,m]),d=U.useCallback(g=>{const f=w.filter(b=>b.id!==g);m(f)},[w,m]);return{encounters:w,isLoading:i,addEncounter:x,updateEncounter:P,deleteEncounter:d}},Ue=()=>{const{encounters:w,addEncounter:m,updateEncounter:i,deleteEncounter:x}=Ce(),{addNotification:P}=Y(),[d,g]=U.useState(null),[f,b]=U.useState(null),[y,S]=U.useState(!1),L=D=>{d?(i(D),g(null),P("success","Encounter Updated")):(m(D),P("success","Encounter Added")),S(!1)},$=D=>{g(D),S(!0)},A=D=>{b(D)},T=()=>{f&&(x(f),(d==null?void 0:d.id)===f&&(g(null),S(!1))),P("success","Encounter Deleted")};return n.jsxs(de,{title:"Encounter Notes",description:"Save and manage your successful fleet formations for different encounters",action:{label:y?"Hide Form":"Add Encounter",onClick:()=>{d&&g(null),S(!y)},variant:y?"secondary":"primary"},children:[n.jsx(fe,{isVisible:y,children:n.jsxs("div",{className:"bg-dark p-4 mb-6",children:[n.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:d?"Edit Encounter":"Add New Encounter"}),n.jsx(ye,{onSubmit:L,initialEncounter:d})]})}),n.jsx(Pe,{encounters:w,onEdit:$,onDelete:A}),n.jsx(me,{isOpen:!!f,onClose:()=>b(null),onConfirm:T,title:"Delete Encounter",message:"Are you sure you want to delete this encounter? This action cannot be undone.",confirmLabel:"Delete"})]})};export{Ue as default};
