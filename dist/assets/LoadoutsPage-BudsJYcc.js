import{u as N,S as q,j as e,I as D,B as w,v as _,C as G,R as F,l as R,G as M,M as P,P as z,p as H,h as I}from"./ui-D2YqbPcu.js";import{a as v}from"./vendor-BhvhDhpY.js";import{u as k}from"./useStorage-6AZ-_ceW.js";import{S as A}from"./ShipSelector-BxvrfkTU.js";import{a as K}from"./ShipDisplay-ApR9I5gC.js";import{G as V}from"./GearSlot-BtS1uLEJ.js";import{G as Y}from"./GearInventory-YrEp50QN.js";import{u as B,a as J}from"./useGear-BHcAIW33.js";import{a as E,u as C}from"./useShips-RXMfKXLW.js";import"./firebaseStorage-B0eyI6ev.js";import"./useEngineeringStats-BBMilB8n.js";import"./GearPieceDisplay-BCww8SQc.js";import"./StatDisplay-zLjdPrVG.js";const Q=q.SHIP_LOADOUTS,W=q.TEAM_LOADOUTS,X=()=>{const{addNotification:s}=N(),{data:n=[],setData:o}=k({key:Q,defaultValue:[]}),{data:u=[],setData:i}=k({key:W,defaultValue:[]}),x=v.useCallback(async t=>{const a={...t,id:crypto.randomUUID(),createdAt:Date.now()};await o([...n,a]),s("success","Loadout added")},[n,o,s]),S=v.useCallback(async(t,a)=>{const c=n.map(p=>p.id===t?{...p,equipment:a}:p);await o(c),s("success","Loadout updated")},[n,o,s]),m=v.useCallback(async t=>{await o(n.filter(a=>a.id!==t)),s("success","Loadout deleted")},[n,o,s]),d=v.useCallback(t=>{const a=new Set;for(const c of t)for(const p of Object.values(c.equipment)){if(a.has(p))return!1;a.add(p)}return!0},[]),f=v.useCallback(async t=>{if(!d(t.shipLoadouts))throw new Error("Invalid team loadout: Duplicate gear pieces detected");const a={...t,id:crypto.randomUUID(),createdAt:Date.now()};await i([...u,a]),s("success","Team loadout added")},[u,i,d,s]),l=v.useCallback(async(t,a)=>{if(!d(a))throw new Error("Invalid team loadout: Duplicate gear pieces detected");const c=u.map(p=>p.id===t?{...p,shipLoadouts:a}:p);await i(c),s("success","Team loadout updated")},[u,i,d,s]),h=v.useCallback(async t=>{await i(u.filter(a=>a.id!==t)),s("success","Team loadout deleted")},[u,i,s]);return{loadouts:n,addLoadout:x,updateLoadout:S,deleteLoadout:m,teamLoadouts:u,addTeamLoadout:f,updateTeamLoadout:l,deleteTeamLoadout:h}},Z=({onSubmit:s,existingNames:n})=>{const[o,u]=v.useState(""),[i,x]=v.useState(null),[S,m]=v.useState(null),d=l=>{if(l.preventDefault(),l.stopPropagation(),!!i){if(n.includes(o.trim())){m("A loadout with this name already exists");return}s({name:o.trim(),shipId:i.id,equipment:i.equipment}),u(""),x(null),m(null)}},f=l=>{u(l.target.value),m(null)};return e.jsxs("form",{onSubmit:d,className:"space-y-4 bg-dark p-4",children:[e.jsx("div",{children:e.jsx(D,{label:"Loadout Name",type:"text",value:o,onChange:f,required:!0,error:S||void 0})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium ",children:"Select Ship"}),e.jsx(A,{onSelect:x,selected:i,sortDirection:"desc"})]}),e.jsx("div",{className:"flex justify-end gap-2",children:e.jsx(w,{"aria-label":"Create loadout",type:"submit",disabled:!i||!o.trim(),children:"Create Loadout"})})]})},O=({name:s,ship:n,equipment:o,availableGear:u,getGearPiece:i,onEquip:x,onDelete:S,showControls:m=!0})=>{const[d,f]=v.useState(null),[l,h]=v.useState(null),t=B(o,i),a=J(o,t),{handleEquipGear:c}=E(),{saveInventory:p}=C(),{addNotification:b}=N(),g=()=>{if(!x)return;const r=new Map,j=new Set;Object.entries(o).forEach(([L,y])=>{if(j.has(y)){b("warning",`Skipped duplicate gear assignment for ${L}`);return}const T=i(y);if(!T){b("error",`Gear piece ${y} not found in inventory`);return}if(T.shipId&&T.shipId!==n.id){const $=T.shipId;b("info",`Unequipped ${L} from ship ${$}`)}r.set(y,n.id),j.add(y),c(n.id,L,y)});const U=u.map(L=>{const y=r.get(L.id);return y!==void 0?{...L,shipId:y}:L});p(U),b("success","Loadout equipped successfully"),x()};return e.jsxs(e.Fragment,{children:[s&&e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx("div",{children:s&&e.jsx("h3",{className:"text-lg font-medium ",children:s})})}),e.jsxs(K,{ship:n,variant:"compact",children:[m&&e.jsxs("div",{className:"flex gap-2 -mt-10",children:[x&&e.jsx(w,{"aria-label":"Equip loadout",variant:"primary",className:"ms-auto",size:"sm",onClick:g,children:e.jsx(_,{})}),S&&e.jsx(w,{"aria-label":"Delete loadout",variant:"danger",size:"sm",onClick:S,children:e.jsx(G,{})})]}),e.jsxs("div",{className:`p-4 mt-3 -mx-3 bg-dark border-t ${F[n.rarity||"common"].borderColor}`,children:[e.jsx("div",{className:"grid grid-cols-3 gap-2 w-fit mx-auto",children:Object.entries(R).map(([r,j])=>e.jsx(V,{slotKey:r,gear:t[o[r]||""],hoveredGear:l,onSelect:f,onHover:h},r))}),a&&a.length>0&&e.jsxs("div",{className:"flex items-center gap-2 pt-3",children:[e.jsx("span",{className:"text-xs text-gray-400",children:"Sets:"}),a.map((r,j)=>e.jsx("img",{src:M[r].iconUrl,alt:r,className:"w-5"},`${r}-${j}`))]})]})]}),e.jsx(P,{isOpen:d!==null,onClose:()=>f(null),title:`Select ${d} for ${n.name} loadout`,children:e.jsx(Y,{inventory:u.filter(r=>d&&r.slot===d),mode:"select",onEquip:()=>{d&&(g(),f(null))},onRemove:()=>{},onEdit:()=>{}})})]})},ee=({loadouts:s,onUpdate:n,onDelete:o,getGearPiece:u,availableGear:i})=>{const{handleEquipGear:x,ships:S}=E();return s.length===0?e.jsx("div",{className:"text-center py-8 text-gray-400 bg-dark-lighter border-2 border-dashed",children:'No loadouts created yet. Create one by clicking the "New Loadout" button above.'}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map(m=>{const d=S.find(f=>f.id===m.shipId);return d?e.jsx("div",{className:"flex flex-col",children:e.jsx(O,{name:m.name,ship:d,equipment:m.equipment,availableGear:i,getGearPiece:u,onEquip:()=>{Object.entries(m.equipment).forEach(([f,l])=>{x(m.shipId,f,l)})},onUpdate:f=>n(m.id,f),onDelete:()=>o(m.id)})},m.id):null})})},te=({onSubmit:s,existingNames:n})=>{const[o,u]=v.useState(""),[i,x]=v.useState([null,null,null,null,null]),[S,m]=v.useState(null),d=(l,h)=>{const t=[...i];t[h]=l,x(t)},f=l=>{if(l.preventDefault(),l.stopPropagation(),i.some(t=>!t))return;if(n.includes(o.trim())){m("A team loadout with this name already exists");return}const h=i.map((t,a)=>({position:a+1,shipId:t.id,equipment:t.equipment}));s({name:o,shipLoadouts:h}),u(""),x([null,null,null,null,null]),m(null)};return e.jsxs("form",{onSubmit:f,className:"space-y-4 bg-dark p-4",children:[e.jsx("div",{children:e.jsx(D,{label:"Team Loadout Name",type:"text",value:o,onChange:l=>u(l.target.value),required:!0,error:S||void 0})}),i.map((l,h)=>e.jsx("div",{children:e.jsx(A,{selected:l,onSelect:t=>d(t,h),sortDirection:"desc"})},h)),e.jsx("div",{className:"flex justify-end gap-2",children:e.jsx(w,{"aria-label":"Create team loadout",type:"submit",disabled:i.some(l=>!l)||!o,children:"Create Team Loadout"})})]})},se=({teamLoadout:s,ships:n,availableGear:o,getGearPiece:u,onUpdate:i,onDelete:x})=>{const{handleEquipGear:S}=E(),{saveInventory:m}=C(),{addNotification:d}=N(),f=()=>{const h=new Map,t=new Set;s.shipLoadouts.forEach(c=>{Object.entries(c.equipment).forEach(([p,b])=>{if(t.has(b)){d("warning",`Skipped duplicate gear assignment for ${p}`);return}const g=u(b);if(!g){d("error",`Gear piece ${b} not found in inventory`);return}if(g.shipId&&g.shipId!==c.shipId){const r=n.find(j=>j.id===g.shipId);r&&d("info",`Unequipped ${p} from ${r.name}`)}h.set(b,c.shipId),t.add(b),S(c.shipId,p,b)})});const a=o.map(c=>{const p=h.get(c.id);return p!==void 0?{...c,shipId:p}:c});m(a),d("success","Team loadout equipped successfully")},l=(h,t)=>{const a=s.shipLoadouts.map(c=>c.position===h?{...c,equipment:t}:c);try{i(s.id,a)}catch(c){alert(c instanceof Error?c.message:"An error occurred")}};return e.jsxs("div",{className:"border-b border-gray-700 pb-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-medium ",children:s.name}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{"aria-label":"Equip team loadout",variant:"primary",size:"sm",onClick:f,children:"Equip Team"}),e.jsx(w,{"aria-label":"Delete loadout",variant:"danger",size:"sm",onClick:()=>x(s.id),children:e.jsx(G,{})})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.shipLoadouts.map(h=>{const t=n.find(a=>a.id===h.shipId);return t?e.jsx(O,{ship:t,equipment:h.equipment,availableGear:o,getGearPiece:u,onUpdate:a=>l(h.position,a),showControls:!1},h.position):null})})]})},xe=()=>{const[s,n]=v.useState(!1),[o,u]=v.useState("individual"),{loadouts:i,addLoadout:x,updateLoadout:S,deleteLoadout:m,teamLoadouts:d,addTeamLoadout:f,updateTeamLoadout:l,deleteTeamLoadout:h}=X(),{getGearPiece:t,inventory:a}=C(),{ships:c}=E(),{addNotification:p}=N(),b=i.map(r=>r.name),g=d.map(r=>r.name);return e.jsxs(z,{title:"Loadouts",description:"Manage your ship gear loadouts, save your favorite setups for easy access.",action:{label:s?"Hide Form":`New ${o==="individual"?"Loadout":"Team"}`,onClick:()=>n(!s),variant:s?"secondary":"primary"},children:[e.jsx(H,{tabs:[{id:"individual",label:"Individual Loadouts"},{id:"team",label:"Team Loadouts"}],activeTab:o,onChange:r=>{u(r),n(!1)}}),o==="individual"?e.jsxs(e.Fragment,{children:[e.jsx(I,{isVisible:s,children:e.jsx(Z,{onSubmit:r=>{x(r),n(!1),window.scrollTo({top:0,behavior:"smooth"}),p("success","Loadout created successfully")},existingNames:b})}),e.jsx(ee,{loadouts:i,onUpdate:S,onDelete:m,getGearPiece:t,availableGear:a})]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{isVisible:s,children:e.jsx(te,{onSubmit:r=>{try{f(r),n(!1),window.scrollTo({top:0,behavior:"smooth"}),p("success","Team loadout created successfully")}catch(j){p("error",j instanceof Error?j.message:"Failed to create team loadout")}},existingNames:g})}),e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[d.map(r=>e.jsx(se,{teamLoadout:r,ships:c,availableGear:a,getGearPiece:t,onUpdate:l,onDelete:h},r.id)),d.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-400 bg-dark-lighter border-2 border-dashed",children:'No team loadouts created yet. Create one by clicking the "New Team" button above.'})]})]})]})};export{xe as LoadoutsPage,xe as default};
